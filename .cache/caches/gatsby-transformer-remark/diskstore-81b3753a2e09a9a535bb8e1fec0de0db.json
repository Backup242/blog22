{"expireTime":9007200908525411000,"key":"transformer-remark-markdown-ast-b75db0fb143126b013304ae8331f7629--","val":{"type":"root","children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"Fetch API","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":12,"offset":12},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":12,"offset":12},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"So far, we know quite a bit about ","position":{"start":{"line":4,"column":1,"offset":14},"end":{"line":4,"column":35,"offset":48},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":4,"column":35,"offset":48},"end":{"line":4,"column":42,"offset":55},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":4,"column":42,"offset":55},"end":{"line":4,"column":43,"offset":56},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":14},"end":{"line":4,"column":43,"offset":56},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Let's see the rest of API, to cover all its abilities.","position":{"start":{"line":6,"column":1,"offset":58},"end":{"line":6,"column":55,"offset":112},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":58},"end":{"line":6,"column":55,"offset":112},"indent":[]}},{"type":"code","lang":"smart","meta":null,"value":"Please note: most of these options are used rarely. You may skip this chapter and still use `fetch` well.\n\nStill, it's good to know what `fetch` can do, so if the need arises, you can return and read the details.","position":{"start":{"line":8,"column":1,"offset":114},"end":{"line":12,"column":4,"offset":339},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Here's the full list of all possible ","position":{"start":{"line":14,"column":1,"offset":341},"end":{"line":14,"column":38,"offset":378},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":14,"column":38,"offset":378},"end":{"line":14,"column":45,"offset":385},"indent":[]}},{"type":"text","value":" options with their default values (alternatives in comments):","position":{"start":{"line":14,"column":45,"offset":385},"end":{"line":14,"column":107,"offset":447},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":341},"end":{"line":14,"column":107,"offset":447},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let promise = fetch(url, {\n  method: \"GET\", // POST, PUT, DELETE, etc.\n  headers: {\n    // the content type header value is usually auto-set\n    // depending on the request body\n    \"Content-Type\": \"text/plain;charset=UTF-8\"\n  },\n  body: undefined // string, FormData, Blob, BufferSource, or URLSearchParams\n  referrer: \"about:client\", // or \"\" to send no Referer header,\n  // or an url from the current origin\n  referrerPolicy: \"no-referrer-when-downgrade\", // no-referrer, origin, same-origin...\n  mode: \"cors\", // same-origin, no-cors\n  credentials: \"same-origin\", // omit, include\n  cache: \"default\", // no-store, reload, no-cache, force-cache, or only-if-cached\n  redirect: \"follow\", // manual, error\n  integrity: \"\", // a hash, like \"sha256-abcdef1234567890\"\n  keepalive: false, // true\n  signal: undefined, // AbortController to abort request\n  window: window // null\n});","position":{"start":{"line":16,"column":1,"offset":449},"end":{"line":37,"column":4,"offset":1337},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"An impressive list, right?","position":{"start":{"line":39,"column":1,"offset":1339},"end":{"line":39,"column":27,"offset":1365},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":1339},"end":{"line":39,"column":27,"offset":1365},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We fully covered ","position":{"start":{"line":41,"column":1,"offset":1367},"end":{"line":41,"column":18,"offset":1384},"indent":[]}},{"type":"inlineCode","value":"method","position":{"start":{"line":41,"column":18,"offset":1384},"end":{"line":41,"column":26,"offset":1392},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":41,"column":26,"offset":1392},"end":{"line":41,"column":28,"offset":1394},"indent":[]}},{"type":"inlineCode","value":"headers","position":{"start":{"line":41,"column":28,"offset":1394},"end":{"line":41,"column":37,"offset":1403},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":41,"column":37,"offset":1403},"end":{"line":41,"column":42,"offset":1408},"indent":[]}},{"type":"inlineCode","value":"body","position":{"start":{"line":41,"column":42,"offset":1408},"end":{"line":41,"column":48,"offset":1414},"indent":[]}},{"type":"text","value":" in the chapter <info:fetch>.","position":{"start":{"line":41,"column":48,"offset":1414},"end":{"line":41,"column":77,"offset":1443},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1367},"end":{"line":41,"column":77,"offset":1443},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":43,"column":1,"offset":1445},"end":{"line":43,"column":5,"offset":1449},"indent":[]}},{"type":"inlineCode","value":"signal","position":{"start":{"line":43,"column":5,"offset":1449},"end":{"line":43,"column":13,"offset":1457},"indent":[]}},{"type":"text","value":" option is covered in <info:fetch-abort>.","position":{"start":{"line":43,"column":13,"offset":1457},"end":{"line":43,"column":54,"offset":1498},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":1445},"end":{"line":43,"column":54,"offset":1498},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now let's explore the remaining capabilities.","position":{"start":{"line":45,"column":1,"offset":1500},"end":{"line":45,"column":46,"offset":1545},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":1500},"end":{"line":45,"column":46,"offset":1545},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"referrer, referrerPolicy","position":{"start":{"line":47,"column":4,"offset":1550},"end":{"line":47,"column":28,"offset":1574},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":1547},"end":{"line":47,"column":28,"offset":1574},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"These options govern how ","position":{"start":{"line":49,"column":1,"offset":1576},"end":{"line":49,"column":26,"offset":1601},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":49,"column":26,"offset":1601},"end":{"line":49,"column":33,"offset":1608},"indent":[]}},{"type":"text","value":" sets the HTTP ","position":{"start":{"line":49,"column":33,"offset":1608},"end":{"line":49,"column":48,"offset":1623},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":49,"column":48,"offset":1623},"end":{"line":49,"column":57,"offset":1632},"indent":[]}},{"type":"text","value":" header.","position":{"start":{"line":49,"column":57,"offset":1632},"end":{"line":49,"column":65,"offset":1640},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":1576},"end":{"line":49,"column":65,"offset":1640},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Usually that header is set automatically and contains the url of the page that made the request. In most scenarios, it's not important at all, sometimes, for security purposes, it makes sense to remove or shorten it.","position":{"start":{"line":51,"column":1,"offset":1642},"end":{"line":51,"column":217,"offset":1858},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":1642},"end":{"line":51,"column":217,"offset":1858},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"The ","position":{"start":{"line":53,"column":3,"offset":1862},"end":{"line":53,"column":7,"offset":1866},"indent":[]}},{"type":"inlineCode","value":"referrer","position":{"start":{"line":53,"column":7,"offset":1866},"end":{"line":53,"column":17,"offset":1876},"indent":[]}},{"type":"text","value":" option allows to set any ","position":{"start":{"line":53,"column":17,"offset":1876},"end":{"line":53,"column":43,"offset":1902},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":53,"column":43,"offset":1902},"end":{"line":53,"column":52,"offset":1911},"indent":[]}},{"type":"text","value":" (within the current origin) or remove it.","position":{"start":{"line":53,"column":52,"offset":1911},"end":{"line":53,"column":94,"offset":1953},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":1860},"end":{"line":53,"column":96,"offset":1955},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":1860},"end":{"line":53,"column":96,"offset":1955},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To send no referer, set an empty string:","position":{"start":{"line":55,"column":1,"offset":1957},"end":{"line":55,"column":41,"offset":1997},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":1957},"end":{"line":55,"column":41,"offset":1997},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"fetch('/page', {\n*!*\n  referrer: \"\" // no Referer header\n*/!*\n});","position":{"start":{"line":57,"column":1,"offset":1999},"end":{"line":63,"column":4,"offset":2074},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To set another url within the current origin:","position":{"start":{"line":65,"column":1,"offset":2076},"end":{"line":65,"column":46,"offset":2121},"indent":[]}}],"position":{"start":{"line":65,"column":1,"offset":2076},"end":{"line":65,"column":46,"offset":2121},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"fetch('/page', {\n  // assuming we're on https://javascript.info\n  // we can set any Referer header, but only within the current origin\n*!*\n  referrer: \"https://javascript.info/anotherpage\"\n*/!*\n});","position":{"start":{"line":67,"column":1,"offset":2123},"end":{"line":75,"column":4,"offset":2330},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"The ","position":{"start":{"line":77,"column":3,"offset":2334},"end":{"line":77,"column":7,"offset":2338},"indent":[]}},{"type":"inlineCode","value":"referrerPolicy","position":{"start":{"line":77,"column":7,"offset":2338},"end":{"line":77,"column":23,"offset":2354},"indent":[]}},{"type":"text","value":" option sets general rules for ","position":{"start":{"line":77,"column":23,"offset":2354},"end":{"line":77,"column":54,"offset":2385},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":77,"column":54,"offset":2385},"end":{"line":77,"column":63,"offset":2394},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":77,"column":63,"offset":2394},"end":{"line":77,"column":64,"offset":2395},"indent":[]}}],"position":{"start":{"line":77,"column":1,"offset":2332},"end":{"line":77,"column":66,"offset":2397},"indent":[]}}],"position":{"start":{"line":77,"column":1,"offset":2332},"end":{"line":77,"column":66,"offset":2397},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Requests are split into 3 types:","position":{"start":{"line":79,"column":1,"offset":2399},"end":{"line":79,"column":33,"offset":2431},"indent":[]}}],"position":{"start":{"line":79,"column":1,"offset":2399},"end":{"line":79,"column":33,"offset":2431},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Request to the same origin.","position":{"start":{"line":81,"column":4,"offset":2436},"end":{"line":81,"column":31,"offset":2463},"indent":[]}}],"position":{"start":{"line":81,"column":4,"offset":2436},"end":{"line":81,"column":31,"offset":2463},"indent":[]}}],"position":{"start":{"line":81,"column":1,"offset":2433},"end":{"line":81,"column":31,"offset":2463},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Request to another origin.","position":{"start":{"line":82,"column":4,"offset":2467},"end":{"line":82,"column":30,"offset":2493},"indent":[]}}],"position":{"start":{"line":82,"column":4,"offset":2467},"end":{"line":82,"column":30,"offset":2493},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":2464},"end":{"line":82,"column":30,"offset":2493},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Request from HTTPS to HTTP (from safe to unsafe protocol).","position":{"start":{"line":83,"column":4,"offset":2497},"end":{"line":83,"column":62,"offset":2555},"indent":[]}}],"position":{"start":{"line":83,"column":4,"offset":2497},"end":{"line":83,"column":62,"offset":2555},"indent":[]}}],"position":{"start":{"line":83,"column":1,"offset":2494},"end":{"line":83,"column":62,"offset":2555},"indent":[]}}],"position":{"start":{"line":81,"column":1,"offset":2433},"end":{"line":83,"column":62,"offset":2555},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Unlike the ","position":{"start":{"line":85,"column":1,"offset":2557},"end":{"line":85,"column":12,"offset":2568},"indent":[]}},{"type":"inlineCode","value":"referrer","position":{"start":{"line":85,"column":12,"offset":2568},"end":{"line":85,"column":22,"offset":2578},"indent":[]}},{"type":"text","value":" option that allows to set the exact ","position":{"start":{"line":85,"column":22,"offset":2578},"end":{"line":85,"column":59,"offset":2615},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":85,"column":59,"offset":2615},"end":{"line":85,"column":68,"offset":2624},"indent":[]}},{"type":"text","value":" value, ","position":{"start":{"line":85,"column":68,"offset":2624},"end":{"line":85,"column":76,"offset":2632},"indent":[]}},{"type":"inlineCode","value":"referrerPolicy","position":{"start":{"line":85,"column":76,"offset":2632},"end":{"line":85,"column":92,"offset":2648},"indent":[]}},{"type":"text","value":" tells the browser general rules for each request type.","position":{"start":{"line":85,"column":92,"offset":2648},"end":{"line":85,"column":147,"offset":2703},"indent":[]}}],"position":{"start":{"line":85,"column":1,"offset":2557},"end":{"line":85,"column":147,"offset":2703},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Possible values are described in the ","position":{"start":{"line":87,"column":1,"offset":2705},"end":{"line":87,"column":38,"offset":2742},"indent":[]}},{"type":"link","title":null,"url":"https://w3c.github.io/webappsec-referrer-policy/","children":[{"type":"text","value":"Referrer Policy specification","position":{"start":{"line":87,"column":39,"offset":2743},"end":{"line":87,"column":68,"offset":2772},"indent":[]}}],"position":{"start":{"line":87,"column":38,"offset":2742},"end":{"line":87,"column":119,"offset":2823},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":87,"column":119,"offset":2823},"end":{"line":87,"column":120,"offset":2824},"indent":[]}}],"position":{"start":{"line":87,"column":1,"offset":2705},"end":{"line":87,"column":120,"offset":2824},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"no-referrer-when-downgrade\"","position":{"start":{"line":89,"column":7,"offset":2832},"end":{"line":89,"column":37,"offset":2862},"indent":[]}}],"position":{"start":{"line":89,"column":5,"offset":2830},"end":{"line":89,"column":39,"offset":2864},"indent":[]}},{"type":"text","value":" -- the default value: full ","position":{"start":{"line":89,"column":39,"offset":2864},"end":{"line":89,"column":67,"offset":2892},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":89,"column":67,"offset":2892},"end":{"line":89,"column":76,"offset":2901},"indent":[]}},{"type":"text","value":" is always sent, unless we send a request from HTTPS to HTTP (to the less secure protocol).","position":{"start":{"line":89,"column":76,"offset":2901},"end":{"line":89,"column":167,"offset":2992},"indent":[]}}],"position":{"start":{"line":89,"column":5,"offset":2830},"end":{"line":89,"column":167,"offset":2992},"indent":[]}}],"position":{"start":{"line":89,"column":1,"offset":2826},"end":{"line":89,"column":167,"offset":2992},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"no-referrer\"","position":{"start":{"line":90,"column":7,"offset":2999},"end":{"line":90,"column":22,"offset":3014},"indent":[]}}],"position":{"start":{"line":90,"column":5,"offset":2997},"end":{"line":90,"column":24,"offset":3016},"indent":[]}},{"type":"text","value":" -- never send ","position":{"start":{"line":90,"column":24,"offset":3016},"end":{"line":90,"column":39,"offset":3031},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":90,"column":39,"offset":3031},"end":{"line":90,"column":48,"offset":3040},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":90,"column":48,"offset":3040},"end":{"line":90,"column":49,"offset":3041},"indent":[]}}],"position":{"start":{"line":90,"column":5,"offset":2997},"end":{"line":90,"column":49,"offset":3041},"indent":[]}}],"position":{"start":{"line":90,"column":1,"offset":2993},"end":{"line":90,"column":49,"offset":3041},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"origin\"","position":{"start":{"line":91,"column":7,"offset":3048},"end":{"line":91,"column":17,"offset":3058},"indent":[]}}],"position":{"start":{"line":91,"column":5,"offset":3046},"end":{"line":91,"column":19,"offset":3060},"indent":[]}},{"type":"text","value":" -- only send the origin in ","position":{"start":{"line":91,"column":19,"offset":3060},"end":{"line":91,"column":47,"offset":3088},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":91,"column":47,"offset":3088},"end":{"line":91,"column":56,"offset":3097},"indent":[]}},{"type":"text","value":", not the full page URL, e.g. only ","position":{"start":{"line":91,"column":56,"offset":3097},"end":{"line":91,"column":91,"offset":3132},"indent":[]}},{"type":"inlineCode","value":"http://site.com","position":{"start":{"line":91,"column":91,"offset":3132},"end":{"line":91,"column":108,"offset":3149},"indent":[]}},{"type":"text","value":" instead of ","position":{"start":{"line":91,"column":108,"offset":3149},"end":{"line":91,"column":120,"offset":3161},"indent":[]}},{"type":"inlineCode","value":"http://site.com/path","position":{"start":{"line":91,"column":120,"offset":3161},"end":{"line":91,"column":142,"offset":3183},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":91,"column":142,"offset":3183},"end":{"line":91,"column":143,"offset":3184},"indent":[]}}],"position":{"start":{"line":91,"column":5,"offset":3046},"end":{"line":91,"column":143,"offset":3184},"indent":[]}}],"position":{"start":{"line":91,"column":1,"offset":3042},"end":{"line":91,"column":143,"offset":3184},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"origin-when-cross-origin\"","position":{"start":{"line":92,"column":7,"offset":3191},"end":{"line":92,"column":35,"offset":3219},"indent":[]}}],"position":{"start":{"line":92,"column":5,"offset":3189},"end":{"line":92,"column":37,"offset":3221},"indent":[]}},{"type":"text","value":" -- send the full ","position":{"start":{"line":92,"column":37,"offset":3221},"end":{"line":92,"column":55,"offset":3239},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":92,"column":55,"offset":3239},"end":{"line":92,"column":64,"offset":3248},"indent":[]}},{"type":"text","value":" to the same origin, but only the origin part for cross-origin requests (as above).","position":{"start":{"line":92,"column":64,"offset":3248},"end":{"line":92,"column":147,"offset":3331},"indent":[]}}],"position":{"start":{"line":92,"column":5,"offset":3189},"end":{"line":92,"column":147,"offset":3331},"indent":[]}}],"position":{"start":{"line":92,"column":1,"offset":3185},"end":{"line":92,"column":147,"offset":3331},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"same-origin\"","position":{"start":{"line":93,"column":7,"offset":3338},"end":{"line":93,"column":22,"offset":3353},"indent":[]}}],"position":{"start":{"line":93,"column":5,"offset":3336},"end":{"line":93,"column":24,"offset":3355},"indent":[]}},{"type":"text","value":" -- send the full ","position":{"start":{"line":93,"column":24,"offset":3355},"end":{"line":93,"column":42,"offset":3373},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":93,"column":42,"offset":3373},"end":{"line":93,"column":51,"offset":3382},"indent":[]}},{"type":"text","value":" to the same origin, but no ","position":{"start":{"line":93,"column":51,"offset":3382},"end":{"line":93,"column":79,"offset":3410},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":93,"column":79,"offset":3410},"end":{"line":93,"column":88,"offset":3419},"indent":[]}},{"type":"text","value":" for cross-origin requests.","position":{"start":{"line":93,"column":88,"offset":3419},"end":{"line":93,"column":115,"offset":3446},"indent":[]}}],"position":{"start":{"line":93,"column":5,"offset":3336},"end":{"line":93,"column":115,"offset":3446},"indent":[]}}],"position":{"start":{"line":93,"column":1,"offset":3332},"end":{"line":93,"column":115,"offset":3446},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"strict-origin\"","position":{"start":{"line":94,"column":7,"offset":3453},"end":{"line":94,"column":24,"offset":3470},"indent":[]}}],"position":{"start":{"line":94,"column":5,"offset":3451},"end":{"line":94,"column":26,"offset":3472},"indent":[]}},{"type":"text","value":" -- send only the origin, not the ","position":{"start":{"line":94,"column":26,"offset":3472},"end":{"line":94,"column":60,"offset":3506},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":94,"column":60,"offset":3506},"end":{"line":94,"column":69,"offset":3515},"indent":[]}},{"type":"text","value":" for HTTPS→HTTP requests.","position":{"start":{"line":94,"column":69,"offset":3515},"end":{"line":94,"column":94,"offset":3540},"indent":[]}}],"position":{"start":{"line":94,"column":5,"offset":3451},"end":{"line":94,"column":94,"offset":3540},"indent":[]}}],"position":{"start":{"line":94,"column":1,"offset":3447},"end":{"line":94,"column":94,"offset":3540},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"strict-origin-when-cross-origin\"","position":{"start":{"line":95,"column":7,"offset":3547},"end":{"line":95,"column":42,"offset":3582},"indent":[]}}],"position":{"start":{"line":95,"column":5,"offset":3545},"end":{"line":95,"column":44,"offset":3584},"indent":[]}},{"type":"text","value":" -- for same-origin send the full ","position":{"start":{"line":95,"column":44,"offset":3584},"end":{"line":95,"column":78,"offset":3618},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":95,"column":78,"offset":3618},"end":{"line":95,"column":87,"offset":3627},"indent":[]}},{"type":"text","value":", for cross-origin send only the origin, unless it's HTTPS→HTTP request, then send nothing.","position":{"start":{"line":95,"column":87,"offset":3627},"end":{"line":95,"column":178,"offset":3718},"indent":[]}}],"position":{"start":{"line":95,"column":5,"offset":3545},"end":{"line":95,"column":178,"offset":3718},"indent":[]}}],"position":{"start":{"line":95,"column":1,"offset":3541},"end":{"line":95,"column":178,"offset":3718},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"\"unsafe-url\"","position":{"start":{"line":96,"column":7,"offset":3725},"end":{"line":96,"column":21,"offset":3739},"indent":[]}}],"position":{"start":{"line":96,"column":5,"offset":3723},"end":{"line":96,"column":23,"offset":3741},"indent":[]}},{"type":"text","value":" -- always send the full url in ","position":{"start":{"line":96,"column":23,"offset":3741},"end":{"line":96,"column":55,"offset":3773},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":96,"column":55,"offset":3773},"end":{"line":96,"column":64,"offset":3782},"indent":[]}},{"type":"text","value":", even for HTTPS→HTTP requests.","position":{"start":{"line":96,"column":64,"offset":3782},"end":{"line":96,"column":95,"offset":3813},"indent":[]}}],"position":{"start":{"line":96,"column":5,"offset":3723},"end":{"line":96,"column":95,"offset":3813},"indent":[]}}],"position":{"start":{"line":96,"column":1,"offset":3719},"end":{"line":96,"column":95,"offset":3813},"indent":[]}}],"position":{"start":{"line":89,"column":1,"offset":2826},"end":{"line":96,"column":95,"offset":3813},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Here's a table with all combinations:","position":{"start":{"line":98,"column":1,"offset":3815},"end":{"line":98,"column":38,"offset":3852},"indent":[]}}],"position":{"start":{"line":98,"column":1,"offset":3815},"end":{"line":98,"column":38,"offset":3852},"indent":[]}},{"type":"table","align":[null,null,null,null],"children":[{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Value","position":{"start":{"line":100,"column":3,"offset":3856},"end":{"line":100,"column":8,"offset":3861},"indent":[]}}],"position":{"start":{"line":100,"column":3,"offset":3856},"end":{"line":100,"column":51,"offset":3904},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"To same origin","position":{"start":{"line":100,"column":54,"offset":3907},"end":{"line":100,"column":68,"offset":3921},"indent":[]}}],"position":{"start":{"line":100,"column":54,"offset":3907},"end":{"line":100,"column":68,"offset":3921},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"To another origin","position":{"start":{"line":100,"column":71,"offset":3924},"end":{"line":100,"column":88,"offset":3941},"indent":[]}}],"position":{"start":{"line":100,"column":71,"offset":3924},"end":{"line":100,"column":88,"offset":3941},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"HTTPS→HTTP","position":{"start":{"line":100,"column":91,"offset":3944},"end":{"line":100,"column":101,"offset":3954},"indent":[]}}],"position":{"start":{"line":100,"column":91,"offset":3944},"end":{"line":100,"column":101,"offset":3954},"indent":[]}}],"position":{"start":{"line":100,"column":1,"offset":3854},"end":{"line":100,"column":103,"offset":3956},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"no-referrer\"","position":{"start":{"line":102,"column":3,"offset":4062},"end":{"line":102,"column":18,"offset":4077},"indent":[]}}],"position":{"start":{"line":102,"column":3,"offset":4062},"end":{"line":102,"column":51,"offset":4110},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":102,"column":54,"offset":4113},"end":{"line":102,"column":55,"offset":4114},"indent":[]}}],"position":{"start":{"line":102,"column":54,"offset":4113},"end":{"line":102,"column":68,"offset":4127},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":102,"column":71,"offset":4130},"end":{"line":102,"column":72,"offset":4131},"indent":[]}}],"position":{"start":{"line":102,"column":71,"offset":4130},"end":{"line":102,"column":88,"offset":4147},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":102,"column":91,"offset":4150},"end":{"line":102,"column":92,"offset":4151},"indent":[]}}],"position":{"start":{"line":102,"column":91,"offset":4150},"end":{"line":102,"column":101,"offset":4160},"indent":[]}}],"position":{"start":{"line":102,"column":1,"offset":4060},"end":{"line":102,"column":103,"offset":4162},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"no-referrer-when-downgrade\"","position":{"start":{"line":103,"column":3,"offset":4165},"end":{"line":103,"column":33,"offset":4195},"indent":[]}},{"type":"text","value":" or ","position":{"start":{"line":103,"column":33,"offset":4195},"end":{"line":103,"column":37,"offset":4199},"indent":[]}},{"type":"inlineCode","value":"\"\"","position":{"start":{"line":103,"column":37,"offset":4199},"end":{"line":103,"column":41,"offset":4203},"indent":[]}},{"type":"text","value":" (default)","position":{"start":{"line":103,"column":41,"offset":4203},"end":{"line":103,"column":51,"offset":4213},"indent":[]}}],"position":{"start":{"line":103,"column":3,"offset":4165},"end":{"line":103,"column":51,"offset":4213},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":103,"column":54,"offset":4216},"end":{"line":103,"column":58,"offset":4220},"indent":[]}}],"position":{"start":{"line":103,"column":54,"offset":4216},"end":{"line":103,"column":68,"offset":4230},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":103,"column":71,"offset":4233},"end":{"line":103,"column":75,"offset":4237},"indent":[]}}],"position":{"start":{"line":103,"column":71,"offset":4233},"end":{"line":103,"column":88,"offset":4250},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":103,"column":91,"offset":4253},"end":{"line":103,"column":92,"offset":4254},"indent":[]}}],"position":{"start":{"line":103,"column":91,"offset":4253},"end":{"line":103,"column":101,"offset":4263},"indent":[]}}],"position":{"start":{"line":103,"column":1,"offset":4163},"end":{"line":103,"column":103,"offset":4265},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"origin\"","position":{"start":{"line":104,"column":3,"offset":4268},"end":{"line":104,"column":13,"offset":4278},"indent":[]}}],"position":{"start":{"line":104,"column":3,"offset":4268},"end":{"line":104,"column":51,"offset":4316},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":104,"column":54,"offset":4319},"end":{"line":104,"column":60,"offset":4325},"indent":[]}}],"position":{"start":{"line":104,"column":54,"offset":4319},"end":{"line":104,"column":68,"offset":4333},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":104,"column":71,"offset":4336},"end":{"line":104,"column":77,"offset":4342},"indent":[]}}],"position":{"start":{"line":104,"column":71,"offset":4336},"end":{"line":104,"column":88,"offset":4353},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":104,"column":91,"offset":4356},"end":{"line":104,"column":97,"offset":4362},"indent":[]}}],"position":{"start":{"line":104,"column":91,"offset":4356},"end":{"line":104,"column":101,"offset":4366},"indent":[]}}],"position":{"start":{"line":104,"column":1,"offset":4266},"end":{"line":104,"column":103,"offset":4368},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"origin-when-cross-origin\"","position":{"start":{"line":105,"column":3,"offset":4371},"end":{"line":105,"column":31,"offset":4399},"indent":[]}}],"position":{"start":{"line":105,"column":3,"offset":4371},"end":{"line":105,"column":51,"offset":4419},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":105,"column":54,"offset":4422},"end":{"line":105,"column":58,"offset":4426},"indent":[]}}],"position":{"start":{"line":105,"column":54,"offset":4422},"end":{"line":105,"column":68,"offset":4436},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":105,"column":71,"offset":4439},"end":{"line":105,"column":77,"offset":4445},"indent":[]}}],"position":{"start":{"line":105,"column":71,"offset":4439},"end":{"line":105,"column":88,"offset":4456},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":105,"column":91,"offset":4459},"end":{"line":105,"column":97,"offset":4465},"indent":[]}}],"position":{"start":{"line":105,"column":91,"offset":4459},"end":{"line":105,"column":101,"offset":4469},"indent":[]}}],"position":{"start":{"line":105,"column":1,"offset":4369},"end":{"line":105,"column":103,"offset":4471},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"same-origin\"","position":{"start":{"line":106,"column":3,"offset":4474},"end":{"line":106,"column":18,"offset":4489},"indent":[]}}],"position":{"start":{"line":106,"column":3,"offset":4474},"end":{"line":106,"column":51,"offset":4522},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":106,"column":54,"offset":4525},"end":{"line":106,"column":58,"offset":4529},"indent":[]}}],"position":{"start":{"line":106,"column":54,"offset":4525},"end":{"line":106,"column":68,"offset":4539},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":106,"column":71,"offset":4542},"end":{"line":106,"column":72,"offset":4543},"indent":[]}}],"position":{"start":{"line":106,"column":71,"offset":4542},"end":{"line":106,"column":88,"offset":4559},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":106,"column":91,"offset":4562},"end":{"line":106,"column":92,"offset":4563},"indent":[]}}],"position":{"start":{"line":106,"column":91,"offset":4562},"end":{"line":106,"column":101,"offset":4572},"indent":[]}}],"position":{"start":{"line":106,"column":1,"offset":4472},"end":{"line":106,"column":103,"offset":4574},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"strict-origin\"","position":{"start":{"line":107,"column":3,"offset":4577},"end":{"line":107,"column":20,"offset":4594},"indent":[]}}],"position":{"start":{"line":107,"column":3,"offset":4577},"end":{"line":107,"column":51,"offset":4625},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":107,"column":54,"offset":4628},"end":{"line":107,"column":60,"offset":4634},"indent":[]}}],"position":{"start":{"line":107,"column":54,"offset":4628},"end":{"line":107,"column":68,"offset":4642},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":107,"column":71,"offset":4645},"end":{"line":107,"column":77,"offset":4651},"indent":[]}}],"position":{"start":{"line":107,"column":71,"offset":4645},"end":{"line":107,"column":88,"offset":4662},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":107,"column":91,"offset":4665},"end":{"line":107,"column":92,"offset":4666},"indent":[]}}],"position":{"start":{"line":107,"column":91,"offset":4665},"end":{"line":107,"column":101,"offset":4675},"indent":[]}}],"position":{"start":{"line":107,"column":1,"offset":4575},"end":{"line":107,"column":103,"offset":4677},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"strict-origin-when-cross-origin\"","position":{"start":{"line":108,"column":3,"offset":4680},"end":{"line":108,"column":38,"offset":4715},"indent":[]}}],"position":{"start":{"line":108,"column":3,"offset":4680},"end":{"line":108,"column":51,"offset":4728},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":108,"column":54,"offset":4731},"end":{"line":108,"column":58,"offset":4735},"indent":[]}}],"position":{"start":{"line":108,"column":54,"offset":4731},"end":{"line":108,"column":68,"offset":4745},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"origin","position":{"start":{"line":108,"column":71,"offset":4748},"end":{"line":108,"column":77,"offset":4754},"indent":[]}}],"position":{"start":{"line":108,"column":71,"offset":4748},"end":{"line":108,"column":88,"offset":4765},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"-","position":{"start":{"line":108,"column":91,"offset":4768},"end":{"line":108,"column":92,"offset":4769},"indent":[]}}],"position":{"start":{"line":108,"column":91,"offset":4768},"end":{"line":108,"column":101,"offset":4778},"indent":[]}}],"position":{"start":{"line":108,"column":1,"offset":4678},"end":{"line":108,"column":103,"offset":4780},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\"unsafe-url\"","position":{"start":{"line":109,"column":3,"offset":4783},"end":{"line":109,"column":17,"offset":4797},"indent":[]}}],"position":{"start":{"line":109,"column":3,"offset":4783},"end":{"line":109,"column":51,"offset":4831},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":109,"column":54,"offset":4834},"end":{"line":109,"column":58,"offset":4838},"indent":[]}}],"position":{"start":{"line":109,"column":54,"offset":4834},"end":{"line":109,"column":68,"offset":4848},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":109,"column":71,"offset":4851},"end":{"line":109,"column":75,"offset":4855},"indent":[]}}],"position":{"start":{"line":109,"column":71,"offset":4851},"end":{"line":109,"column":88,"offset":4868},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"full","position":{"start":{"line":109,"column":91,"offset":4871},"end":{"line":109,"column":95,"offset":4875},"indent":[]}}],"position":{"start":{"line":109,"column":91,"offset":4871},"end":{"line":109,"column":101,"offset":4881},"indent":[]}}],"position":{"start":{"line":109,"column":1,"offset":4781},"end":{"line":109,"column":103,"offset":4883},"indent":[]}}],"position":{"start":{"line":100,"column":1,"offset":3854},"end":{"line":109,"column":103,"offset":4883},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Let's say we have an admin zone with a URL structure that shouldn't be known from outside of the site.","position":{"start":{"line":111,"column":1,"offset":4885},"end":{"line":111,"column":103,"offset":4987},"indent":[]}}],"position":{"start":{"line":111,"column":1,"offset":4885},"end":{"line":111,"column":103,"offset":4987},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If we send a ","position":{"start":{"line":113,"column":1,"offset":4989},"end":{"line":113,"column":14,"offset":5002},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":113,"column":14,"offset":5002},"end":{"line":113,"column":21,"offset":5009},"indent":[]}},{"type":"text","value":", then by default it always sends the ","position":{"start":{"line":113,"column":21,"offset":5009},"end":{"line":113,"column":59,"offset":5047},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":113,"column":59,"offset":5047},"end":{"line":113,"column":68,"offset":5056},"indent":[]}},{"type":"text","value":" header with the full url of our page (except when we request from HTTPS to HTTP, then no ","position":{"start":{"line":113,"column":68,"offset":5056},"end":{"line":113,"column":158,"offset":5146},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":113,"column":158,"offset":5146},"end":{"line":113,"column":167,"offset":5155},"indent":[]}},{"type":"text","value":").","position":{"start":{"line":113,"column":167,"offset":5155},"end":{"line":113,"column":169,"offset":5157},"indent":[]}}],"position":{"start":{"line":113,"column":1,"offset":4989},"end":{"line":113,"column":169,"offset":5157},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"E.g. ","position":{"start":{"line":115,"column":1,"offset":5159},"end":{"line":115,"column":6,"offset":5164},"indent":[]}},{"type":"inlineCode","value":"Referer: https://javascript.info/admin/secret/paths","position":{"start":{"line":115,"column":6,"offset":5164},"end":{"line":115,"column":59,"offset":5217},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":115,"column":59,"offset":5217},"end":{"line":115,"column":60,"offset":5218},"indent":[]}}],"position":{"start":{"line":115,"column":1,"offset":5159},"end":{"line":115,"column":60,"offset":5218},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If we'd like other websites know only the origin part, not the URL-path, we can set the option:","position":{"start":{"line":117,"column":1,"offset":5220},"end":{"line":117,"column":96,"offset":5315},"indent":[]}}],"position":{"start":{"line":117,"column":1,"offset":5220},"end":{"line":117,"column":96,"offset":5315},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"fetch('https://another.com/page', {\n    // ...\n    referrerPolicy: 'origin-when-cross-origin' // Referer: https://javascript.info\n});","position":{"start":{"line":119,"column":1,"offset":5317},"end":{"line":124,"column":4,"offset":5460},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"We can put it to all ","position":{"start":{"line":126,"column":1,"offset":5462},"end":{"line":126,"column":22,"offset":5483},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":126,"column":22,"offset":5483},"end":{"line":126,"column":29,"offset":5490},"indent":[]}},{"type":"text","value":" calls, maybe integrate into JavaScript library of our project that does all requests and uses ","position":{"start":{"line":126,"column":29,"offset":5490},"end":{"line":126,"column":124,"offset":5585},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":126,"column":124,"offset":5585},"end":{"line":126,"column":131,"offset":5592},"indent":[]}},{"type":"text","value":" inside.","position":{"start":{"line":126,"column":131,"offset":5592},"end":{"line":126,"column":139,"offset":5600},"indent":[]}}],"position":{"start":{"line":126,"column":1,"offset":5462},"end":{"line":126,"column":139,"offset":5600},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Its only difference compared to the default behavior is that for requests to another origin ","position":{"start":{"line":128,"column":1,"offset":5602},"end":{"line":128,"column":93,"offset":5694},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":128,"column":93,"offset":5694},"end":{"line":128,"column":100,"offset":5701},"indent":[]}},{"type":"text","value":" sends only the origin part of the URL (e.g. ","position":{"start":{"line":128,"column":100,"offset":5701},"end":{"line":128,"column":145,"offset":5746},"indent":[]}},{"type":"inlineCode","value":"https://javascript.info","position":{"start":{"line":128,"column":145,"offset":5746},"end":{"line":128,"column":170,"offset":5771},"indent":[]}},{"type":"text","value":", without path). For requests to our origin we still get the full ","position":{"start":{"line":128,"column":170,"offset":5771},"end":{"line":128,"column":236,"offset":5837},"indent":[]}},{"type":"inlineCode","value":"Referer","position":{"start":{"line":128,"column":236,"offset":5837},"end":{"line":128,"column":245,"offset":5846},"indent":[]}},{"type":"text","value":" (maybe useful for debugging purposes).","position":{"start":{"line":128,"column":245,"offset":5846},"end":{"line":128,"column":284,"offset":5885},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":5602},"end":{"line":128,"column":284,"offset":5885},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"`","position":{"start":{"line":130,"column":1,"offset":5887},"end":{"line":130,"column":2,"offset":5888},"indent":[]}},{"type":"inlineCode","value":"","position":{"start":{"line":130,"column":2,"offset":5888},"end":{"line":130,"column":4,"offset":5890},"indent":[]}},{"type":"text","value":"smart header=\"Referrer policy is not only for ","position":{"start":{"line":130,"column":4,"offset":5890},"end":{"line":130,"column":50,"offset":5936},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":130,"column":50,"offset":5936},"end":{"line":130,"column":57,"offset":5943},"indent":[]}},{"type":"text","value":"\" Referrer policy, described in the ","position":{"start":{"line":130,"column":57,"offset":5943},"end":{"line":130,"column":93,"offset":5979},"indent":[]}},{"type":"link","title":null,"url":"https://w3c.github.io/webappsec-referrer-policy/","children":[{"type":"text","value":"specification","position":{"start":{"line":130,"column":94,"offset":5980},"end":{"line":130,"column":107,"offset":5993},"indent":[]}}],"position":{"start":{"line":130,"column":93,"offset":5979},"end":{"line":130,"column":158,"offset":6044},"indent":[]}},{"type":"text","value":", is not just for ","position":{"start":{"line":130,"column":158,"offset":6044},"end":{"line":130,"column":176,"offset":6062},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":130,"column":176,"offset":6062},"end":{"line":130,"column":183,"offset":6069},"indent":[]}},{"type":"text","value":", but more global.","position":{"start":{"line":130,"column":183,"offset":6069},"end":{"line":130,"column":201,"offset":6087},"indent":[]}}],"position":{"start":{"line":130,"column":1,"offset":5887},"end":{"line":130,"column":201,"offset":6087},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In particular, it's possible to set the default policy for the whole page using the ","position":{"start":{"line":132,"column":1,"offset":6089},"end":{"line":132,"column":85,"offset":6173},"indent":[]}},{"type":"inlineCode","value":"Referrer-Policy","position":{"start":{"line":132,"column":85,"offset":6173},"end":{"line":132,"column":102,"offset":6190},"indent":[]}},{"type":"text","value":" HTTP header, or per-link, with ","position":{"start":{"line":132,"column":102,"offset":6190},"end":{"line":132,"column":134,"offset":6222},"indent":[]}},{"type":"inlineCode","value":"<a rel=\"noreferrer\">","position":{"start":{"line":132,"column":134,"offset":6222},"end":{"line":132,"column":156,"offset":6244},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":132,"column":156,"offset":6244},"end":{"line":132,"column":157,"offset":6245},"indent":[]}}],"position":{"start":{"line":132,"column":1,"offset":6089},"end":{"line":132,"column":157,"offset":6245},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"## mode\n\nThe `mode` option is a safe-guard that prevents occasional cross-origin requests:\n\n- **`\"cors\"`** -- the default, cross-origin requests are allowed, as described in <info:fetch-crossorigin>,\n- **`\"same-origin\"`** -- cross-origin requests are forbidden,\n- **`\"no-cors\"`** -- only safe cross-origin requests are allowed.\n\nThis option may be useful when the URL for `fetch` comes from a 3rd-party, and we want a \"power off switch\" to limit cross-origin capabilities.\n\n## credentials\n\nThe `credentials` option specifies whether `fetch` should send cookies and HTTP-Authorization headers with the request.\n\n- **`\"same-origin\"`** -- the default, don't send for cross-origin requests,\n- **`\"include\"`** -- always send, requires `Accept-Control-Allow-Credentials` from cross-origin server in order for JavaScript to access the response, that was covered in the chapter <info:fetch-crossorigin>,\n- **`\"omit\"`** -- never send, even for same-origin requests.\n\n## cache\n\nBy default, `fetch` requests make use of standard HTTP-caching. That is, it respects the `Expires` and `Cache-Control` headers, sends `If-Modified-Since` and so on. Just like regular HTTP-requests do.\n\nThe `cache` options allows to ignore HTTP-cache or fine-tune its usage:\n\n- **`\"default\"`** -- `fetch` uses standard HTTP-cache rules and headers,\n- **`\"no-store\"`** -- totally ignore HTTP-cache, this mode becomes the default if we set a header `If-Modified-Since`, `If-None-Match`, `If-Unmodified-Since`, `If-Match`, or `If-Range`,\n- **`\"reload\"`** -- don't take the result from HTTP-cache (if any), but populate the cache with the response (if the response headers permit this action),\n- **`\"no-cache\"`** -- create a conditional request if there is a cached response, and a normal request otherwise. Populate HTTP-cache with the response,\n- **`\"force-cache\"`** -- use a response from HTTP-cache, even if it's stale. If there's no response in HTTP-cache, make a regular HTTP-request, behave normally,\n- **`\"only-if-cached\"`** -- use a response from HTTP-cache, even if it's stale. If there's no response in HTTP-cache, then error. Only works when `mode` is `\"same-origin\"`.\n\n## redirect\n\nNormally, `fetch` transparently follows HTTP-redirects, like 301, 302 etc.\n\nThe `redirect` option allows to change that:\n\n- **`\"follow\"`** -- the default, follow HTTP-redirects,\n- **`\"error\"`** -- error in case of HTTP-redirect,\n- **`\"manual\"`** -- allows to process HTTP-redirects manually. In case of redirect, we'll get a special response object, with `response.type=\"opaqueredirect\"` and zeroed/empty status and most other properies.\n\n## integrity\n\nThe `integrity` option allows to check if the response matches the known-ahead checksum.\n\nAs described in the [specification](https://w3c.github.io/webappsec-subresource-integrity/), supported hash-functions are SHA-256, SHA-384, and SHA-512, there might be others depending on the browser.\n\nFor example, we're downloading a file, and we know that it's SHA-256 checksum is \"abcdef\" (a real checksum is longer, of course).\n\nWe can put it in the `integrity` option, like this:\n\n```js\nfetch('http://site.com/file', {\n  integrity: 'sha256-abcdef'\n});","position":{"start":{"line":134,"column":1,"offset":6247},"end":{"line":191,"column":5,"offset":9415},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Then ","position":{"start":{"line":193,"column":1,"offset":9417},"end":{"line":193,"column":6,"offset":9422},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":193,"column":6,"offset":9422},"end":{"line":193,"column":13,"offset":9429},"indent":[]}},{"type":"text","value":" will calculate SHA-256 on its own and compare it with our string. In case of a mismatch, an error is triggered.","position":{"start":{"line":193,"column":13,"offset":9429},"end":{"line":193,"column":125,"offset":9541},"indent":[]}}],"position":{"start":{"line":193,"column":1,"offset":9417},"end":{"line":193,"column":125,"offset":9541},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"keepalive","position":{"start":{"line":195,"column":4,"offset":9546},"end":{"line":195,"column":13,"offset":9555},"indent":[]}}],"position":{"start":{"line":195,"column":1,"offset":9543},"end":{"line":195,"column":13,"offset":9555},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":197,"column":1,"offset":9557},"end":{"line":197,"column":5,"offset":9561},"indent":[]}},{"type":"inlineCode","value":"keepalive","position":{"start":{"line":197,"column":5,"offset":9561},"end":{"line":197,"column":16,"offset":9572},"indent":[]}},{"type":"text","value":" option indicates that the request may \"outlive\" the webpage that initiated it.","position":{"start":{"line":197,"column":16,"offset":9572},"end":{"line":197,"column":95,"offset":9651},"indent":[]}}],"position":{"start":{"line":197,"column":1,"offset":9557},"end":{"line":197,"column":95,"offset":9651},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For example, we gather statistics on how the current visitor uses our page (mouse clicks, page fragments he views), to analyze and improve the user experience.","position":{"start":{"line":199,"column":1,"offset":9653},"end":{"line":199,"column":160,"offset":9812},"indent":[]}}],"position":{"start":{"line":199,"column":1,"offset":9653},"end":{"line":199,"column":160,"offset":9812},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When the visitor leaves our page -- we'd like to save the data to our server.","position":{"start":{"line":201,"column":1,"offset":9814},"end":{"line":201,"column":78,"offset":9891},"indent":[]}}],"position":{"start":{"line":201,"column":1,"offset":9814},"end":{"line":201,"column":78,"offset":9891},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We can use the ","position":{"start":{"line":203,"column":1,"offset":9893},"end":{"line":203,"column":16,"offset":9908},"indent":[]}},{"type":"inlineCode","value":"window.onunload","position":{"start":{"line":203,"column":16,"offset":9908},"end":{"line":203,"column":33,"offset":9925},"indent":[]}},{"type":"text","value":" event for that:","position":{"start":{"line":203,"column":33,"offset":9925},"end":{"line":203,"column":49,"offset":9941},"indent":[]}}],"position":{"start":{"line":203,"column":1,"offset":9893},"end":{"line":203,"column":49,"offset":9941},"indent":[]}},{"type":"code","lang":"js","meta":"run","value":"window.onunload = function() {\n  fetch('/analytics', {\n    method: 'POST',\n    body: \"statistics\",\n*!*\n    keepalive: true\n*/!*\n  });\n};","position":{"start":{"line":205,"column":1,"offset":9943},"end":{"line":215,"column":4,"offset":10093},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Normally, when a document is unloaded, all associated network requests are aborted. But the ","position":{"start":{"line":217,"column":1,"offset":10095},"end":{"line":217,"column":93,"offset":10187},"indent":[]}},{"type":"inlineCode","value":"keepalive","position":{"start":{"line":217,"column":93,"offset":10187},"end":{"line":217,"column":104,"offset":10198},"indent":[]}},{"type":"text","value":" option tells the browser to perform the request in the background, even after it leaves the page. So this option is essential for our request to succeed.","position":{"start":{"line":217,"column":104,"offset":10198},"end":{"line":217,"column":258,"offset":10352},"indent":[]}}],"position":{"start":{"line":217,"column":1,"offset":10095},"end":{"line":217,"column":258,"offset":10352},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It has a few limitations:","position":{"start":{"line":219,"column":1,"offset":10354},"end":{"line":219,"column":26,"offset":10379},"indent":[]}}],"position":{"start":{"line":219,"column":1,"offset":10354},"end":{"line":219,"column":26,"offset":10379},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We can't send megabytes: the body limit for ","position":{"start":{"line":221,"column":5,"offset":10385},"end":{"line":221,"column":49,"offset":10429},"indent":[]}},{"type":"inlineCode","value":"keepalive","position":{"start":{"line":221,"column":49,"offset":10429},"end":{"line":221,"column":60,"offset":10440},"indent":[]}},{"type":"text","value":" requests is 64KB.","position":{"start":{"line":221,"column":60,"offset":10440},"end":{"line":221,"column":78,"offset":10458},"indent":[]}}],"position":{"start":{"line":221,"column":5,"offset":10385},"end":{"line":221,"column":78,"offset":10458},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If we need to gather a lot of statistics about the visit, we should send it out regularly in packets, so that there won't be a lot left for the last ","position":{"start":{"line":222,"column":9,"offset":10467},"end":{"line":222,"column":158,"offset":10616},"indent":[]}},{"type":"inlineCode","value":"onunload","position":{"start":{"line":222,"column":158,"offset":10616},"end":{"line":222,"column":168,"offset":10626},"indent":[]}},{"type":"text","value":" request.","position":{"start":{"line":222,"column":168,"offset":10626},"end":{"line":222,"column":177,"offset":10635},"indent":[]}}],"position":{"start":{"line":222,"column":9,"offset":10467},"end":{"line":222,"column":177,"offset":10635},"indent":[]}}],"position":{"start":{"line":222,"column":5,"offset":10463},"end":{"line":222,"column":177,"offset":10635},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This limit applies to all ","position":{"start":{"line":223,"column":9,"offset":10644},"end":{"line":223,"column":35,"offset":10670},"indent":[]}},{"type":"inlineCode","value":"keepalive","position":{"start":{"line":223,"column":35,"offset":10670},"end":{"line":223,"column":46,"offset":10681},"indent":[]}},{"type":"text","value":" requests together. In other words, we can perform multiple ","position":{"start":{"line":223,"column":46,"offset":10681},"end":{"line":223,"column":106,"offset":10741},"indent":[]}},{"type":"inlineCode","value":"keepalive","position":{"start":{"line":223,"column":106,"offset":10741},"end":{"line":223,"column":117,"offset":10752},"indent":[]}},{"type":"text","value":" requests in parallel, but the sum of their body lengths should not exceed 64KB.","position":{"start":{"line":223,"column":117,"offset":10752},"end":{"line":223,"column":197,"offset":10832},"indent":[]}}],"position":{"start":{"line":223,"column":9,"offset":10644},"end":{"line":223,"column":197,"offset":10832},"indent":[]}}],"position":{"start":{"line":223,"column":5,"offset":10640},"end":{"line":223,"column":197,"offset":10832},"indent":[]}}],"position":{"start":{"line":222,"column":5,"offset":10463},"end":{"line":223,"column":197,"offset":10832},"indent":[5]}}],"position":{"start":{"line":221,"column":1,"offset":10381},"end":{"line":223,"column":197,"offset":10832},"indent":[1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We can't handle the server response if the document is unloaded. So in our example ","position":{"start":{"line":224,"column":5,"offset":10837},"end":{"line":224,"column":88,"offset":10920},"indent":[]}},{"type":"inlineCode","value":"fetch","position":{"start":{"line":224,"column":88,"offset":10920},"end":{"line":224,"column":95,"offset":10927},"indent":[]}},{"type":"text","value":" will succeed due to ","position":{"start":{"line":224,"column":95,"offset":10927},"end":{"line":224,"column":116,"offset":10948},"indent":[]}},{"type":"inlineCode","value":"keepalive","position":{"start":{"line":224,"column":116,"offset":10948},"end":{"line":224,"column":127,"offset":10959},"indent":[]}},{"type":"text","value":", but subsequent functions won't work.","position":{"start":{"line":224,"column":127,"offset":10959},"end":{"line":224,"column":165,"offset":10997},"indent":[]}}],"position":{"start":{"line":224,"column":5,"offset":10837},"end":{"line":224,"column":165,"offset":10997},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In most cases, such as sending out statistics, it's not a problem, as the server just accepts the data and usually sends an empty response to such requests.","position":{"start":{"line":225,"column":9,"offset":11006},"end":{"line":225,"column":165,"offset":11162},"indent":[]}}],"position":{"start":{"line":225,"column":9,"offset":11006},"end":{"line":225,"column":165,"offset":11162},"indent":[]}}],"position":{"start":{"line":225,"column":5,"offset":11002},"end":{"line":225,"column":165,"offset":11162},"indent":[]}}],"position":{"start":{"line":225,"column":5,"offset":11002},"end":{"line":225,"column":165,"offset":11162},"indent":[]}}],"position":{"start":{"line":224,"column":1,"offset":10833},"end":{"line":225,"column":165,"offset":11162},"indent":[1]}}],"position":{"start":{"line":221,"column":1,"offset":10381},"end":{"line":225,"column":165,"offset":11162},"indent":[1,1,1,1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":226,"column":1,"offset":11163}}}}